preamble: >
  using PyPlot;
  const id = "street";
  const u = 0.1;
  const datadir = joinpath("data", id);
  const ni = 1500;
  const nj = 250;
  const iso = 50;
  const ieo = 100;
  const jso = 100;
  const jeo = 150;

datadir:    {   value:  datadir,    expr:   true  }

rho_0:      {   value:  1.0,        expr:   false }
nu:         {   value:  0.2,        expr:   false }

dx:         {   value:  1.0,        expr:   false }
dt:         {   value:  1.0,        expr:   false }
ni:         {   value:  ni,         expr:   true  }
nj:         {   value:  nj,         expr:   true  }

nsteps:     {   value: 100000,      expr:   false }
col_f:  srt_col_f!

sbounds:
  value: >
    [1    iso   1     nj;
     iso  ieo   1     jso;
     iso  ieo   jeo   nj;
     ieo  ni    1     nj]
  expr: true

cbounds:
  value: >
    [1    iso   1     nj;
     iso  ieo   1     jso;
     iso  ieo   jeo   nj;
     ieo  ni    1     nj]
  expr: true

# boundary conditions
bcs:
  - north_bounce_back!
  - south_bounce_back!
  - >
    begin;
      bind_west_inlet!(lat::Lattice) = west_inlet!(lat, u);
      return bind_west_inlet!;
    end
  - >
    begin;
      bind_east_pressure!(lat::Lattice) = east_pressure!(lat, 1.0);
      return bind_east_pressure!;
    end
  - >
    begin;
      obstacle_bounce_back!(lat::Lattice) = begin;
        north_bounce_back!(lat, iso, ieo, jso);
        west_bounce_back!(lat, iso, jso, jeo);
        south_bounce_back!(lat, iso, ieo, jeo);
        east_bounce_back!(lat, ieo, jso, jeo);
      end
      return obstacle_bounce_back!;
    end
# callback functions
callbacks:
  - plot_streamlines_callback(10, joinpath(datadir, "s1"), 0.0)
  - print_step_callback(100, id)
  - write_backup_file_callback(datadir, 500)

# clean-up, backup, write out
finally:
  - plot_streamlines_callback(1, joinpath(datadir, "sl"), 0.0);
  - write_backup_file_callback(datadir)
